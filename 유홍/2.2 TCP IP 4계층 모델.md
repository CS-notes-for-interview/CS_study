# 2.2. TCP/IP 4계층 모델

인터넷 프로토콜 스위트(internet protocol suite) : 인터넷에서 컴퓨터들이 서로 정보를 주고받는데 쓰이는 프로토콜의 집합

인터넷 프로토콜 스위트는 TCP/IP 4계층 모델이나 OSI 7계층 모델로 설명 가능

이하는 TCP/IP 4계층 모델로 설명

TCP/IP 4계층 모델 - 네트워크에서 사용되는 통신 프로토콜의 집합 / 네트워킹 범위에 따라 네개의 추상화 계층으로 구성 (어플리케이션 계층, 전송계층, 인터넷 계층, 링크 계층)

---

## 2.2.1. 계층구조

네개의 계층으로 구성

각 계층 변경 시 다른 계층 영향 X -> 유연한 설계

(ex. 전송계층 TCP -> UDP로 변경해도 웹브라우저 재설치 필요는 X)

각 계층 대표 스택

    링크 계층 - 이더넷

    인터넷 계층 - IP/ARP/ICMP

    전송 계층 - TCP/UDP/QUIC

    애플리케이션 계층 - FTP/HTTP/SSH/SMTP/DNS



OSI 7계층과 비교

    rf) OSI 7계층 : 1 - 물리 계층 / 2 - 데이터 링크 계층 / 3 - 네트워크 계층 / 4 - 전송 계층 / 5 - 세션 계층 / 6 - 표현(프레젠테이션) 계층 / 7 - 응용(애플리케이션) 계층

    OSI 1,2 계층 (물리, 데이터링크 계층) -> TcP/IP 1 계층 (링크 계층)

    OSI 3 계층 (네트워크 계층) -> TcP/IP 2 계층 (인터넷 계층)

    OSI 4 계층 (전송 계층) -> TcP/IP 3 계층 (전송 계층)

    OSI 5,6,7 계층 (세션, 표현, 응용 계층) -> TcP/IP 4 계층 (애플리케이션 계층)



---

- 어플리케이션 계층
  
  - 응용 프로그램이 사용되는 프로토콜 계층
  
  - 웹 서비스, 이메일 등 실질적 서비스를 제공하는 계층
  
  - FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램
    
    - FTP : 장치 간 파일 전송 표준 통신 프로토콜
    
    - HTTP : WWW를 위한 데이터 통신의 기초, 웹 사이트 이용 프로토콜
    
    - SSH : 보안 X 네트워크에서 네트워크 서비스 안전하게 운영하기 위한 암호화 네트워크 프로토콜
    
    - SMTP : 전자 메일 전송 인터넷 프로토콜
    
    - DNS : 도메인 이름과 IP 주소 매핑해주는 서버

---

- 전송 계층
  
  - 송신자 - 수신자 연결 통신 서비스 제공, 연결 지향 데이터 스트림 지원, 신뢰성, 흐름제어 제공
  
  - 애플리케이션 계층 - 인터넷 계층 사이 데이터 중계 역할
  
  - TCP, UDP 등
    
    - TCP 
      
      - 패킷 사이 순서 보장
      
      - 연결지향 프로토콜 -> 수신 여부 확인 -> 신뢰성
      
      - 가상회선 패킷 교환 방식
        
        - 각 패킷에 가상회선 식별자 포함
        
        - 패킷 전송 후 가상회선 해제
        
        - 패킷 - 전송 순서대로 도착
    
    - UDP
      
      - 패킷 순서 보장 X
      
      - 수신 여부 확인 X, 단순 데이터 주기만
      
      - 데이터그램 패킷 교환 방식
        
        - 메세지 -> 분할된 패킷 최적 경로로 독립적 이동 (서로 다른 경로 가능) -> 전송 순서, 도착 순서 다를 수도
  
  - TCP 연결 성립/해제
    
    - 용어
      
      - SYN (SYNchronization) : 연결 요청 플래그
      
      - ACK (ACKnowledgement) : 응답 플래그
      
      - ISN (Initial Sequence Numbers) : 초기 네트워크 연결 시 할당된 32비트 고유 시퀀스 번호
    
    - 성립
      
      - 3-웨이 핸드셰이크(3-way-handshake) 작업 -> 신뢰성 확보
      
      - 신뢰성 확보 후 데이터 전송 시작 -> TCP : 신뢰성 있는 계층 (UDP : 신뢰성 없는 계층 - 3웨이 핸드셰이크 과정 X)
      
      - 과정
        
        - (서버/클라이언트 모두 CLOSED 상태로 시작)
          (서버 대기 - LISTEN 상태)
        
        - SYN : 클라이언트 -- ISN 담은 SYN --> 서버
          
          -  ISN : 새로운 TCP 연결의 첫번째 패킷에 할당된 임의의 시퀀스 번호
          
          - (클라이언트 : SYN-SENT / 서버 : SYN-RECEIVED)
        
        - SYN  + ACK : 서버, 클라이언트 SYN 수신 후 -- 서버의 ISN, 승인번호(ISN + 1) --> 클라이언트
          
          - (클라이언트 :  ESTABLISHED)
        
        - ACK : 클라이언트 -- 승인번호(서버의 ISN+1) 담은 ACK --> 서버
          
          - (서버 : ESTABLISHED)
    
    - 해제
      
      - 4-웨이 핸드셰이크 (4-way handshake) 과정
        
        - (서버/클라이언트 모두 ESTABLISHED 상태로 시작)
        
        - 클라이언트 -- FIN 세그먼트 --> 서버
          
          - (클라이언트 : FIN_WAIT_1)
        
        - 서버 -- ACK (승인 세그먼트) --> 클라이언트
          
          - (서버 : CLOSED_WAIT /  클라이언트 : FIN_WAIT_2)
        
        - ACK 보내고 일정시간 후, 서버 -- FIN 세그먼트 --> 클라이언트
          
          - (서버 : LAST_ACK / 클라이언트 : TIME_WAIT)
          
          - TIME_WAIT 
            
            - 소켓이 바로 소멸되지 않고, 일정 시간 유지되는 상태
            
            - OS마다 TIME_WAIT 시간 상이 (우분투 60초, 윈도우 4분)
            
            - 지연 패킷 발생 대비 (무결성 문제 방지 -> 일관성, 정확성 유지)
            
            - 장치 간 연결 닫힘 확인 (서버가 LAST_ACK -> CLOSED 되도록, 새로운 연결시 오류 방지)
        
        - 클라이언트 -- ACK --> 서버
          
          - (서버 : CLOSE / 클라이언트 : 일정 시간 대기 후 CLOSED)

---

- 인터넷 계층
  
  - 장치로부터 받은 네트워크 패킷 -> 지정된 IP 주소 목적지로 전송
  
  - IP, ARP, ICMP등
  
  - 상대가 제대로 받았는지에 대해 보장 X (비연결적 특징)

---

- 링크 계층 (네트워크 접근 계층)
  
  실질적으로 데이터를 전달, 장치 간 신호 주고받는 규칙 정하는 계층
  
  물리 계층(유/무선 LAN을 통해 0과 1로 이루어진 데이터 전송) + 데이터 링크 계층(이더넷 프레임 통해 에러 확인, 흐름 제어, 접근 제어)
  
  - 유선
  
  - 무선

---

- 계층 간 송수신
